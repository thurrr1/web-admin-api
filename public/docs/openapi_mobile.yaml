openapi: 3.0.0
info:
  title: ASN E-Absensi API
  description: Dokumentasi API untuk Backend Absensi ASN (Go Fiber)
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: Local Development Server

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Deskripsi error"
      required:
        - error

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

paths:
  # =======================
  # AUTH & PROFILE
  # =======================
  /api/login:
    post:
      summary: Login User
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nip:
                  type: string
                  example: "123456789"
                password:
                  type: string
                  example: "admin123"
                device_id:
                  type: string
                  example: "uuid-device-123"
                brand:
                  type: string
                  example: "Samsung"
                series:
                  type: string
                  example: "Galaxy S23"
      responses:
        200:
          description: Login Berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  token:
                    type: string
                  refresh_token:
                    type: string
                  data:
                    type: object
        400:
          description: Format Data Salah
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Format data salah"
        401:
          description: Login Gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "NIP atau Password salah"
        403:
          description: Device Tidak Cocok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Akun ini terkunci pada perangkat lain. Hubungi admin untuk reset."

  /api/refresh-token:
    post:
      summary: Refresh Access Token
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
      responses:
        200:
          description: Token Refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  refresh_token:
                    type: string

  /api/asn/profile:
    get:
      summary: Get Profile Saya
      tags: [Auth]
      responses:
        200:
          description: Data Profile
    put:
      summary: Update Profile Saya
      tags: [Auth]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                no_hp:
                  type: string
                foto:
                  type: string
                  description: Base64 string
      responses:
        200:
          description: Berhasil update

  /api/asn/password:
    put:
      summary: Ganti Password
      tags: [Auth]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                old_password:
                  type: string
                new_password:
                  type: string
      responses:
        200:
          description: Password berhasil diubah

  /api/asn/atasan-list:
    get:
      summary: Get List Kandidat Atasan
      tags: [Auth]
      responses:
        200:
          description: List ASN yang bisa dijadikan atasan
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        ID: { type: integer }
                        nama: { type: string }
                        nip: { type: string }
                        jabatan: { type: string }

  /api/asn/atasan:
    post:
      summary: Update Atasan Saya
      tags: [Auth]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                atasan_id: { type: integer }
      responses:
        200:
          description: Atasan berhasil diperbarui

  # =======================
  # LUPA PASSWORD (OTP)
  # =======================
  /api/forgot-password/request:
    post:
      summary: Request OTP Reset Password
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nip: { type: string }
      responses:
        200:
          description: OTP dikirim ke email

  /api/forgot-password/verify:
    post:
      summary: Verifikasi Kode OTP
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nip: { type: string }
                otp: { type: string }
      responses:
        200:
          description: OTP Valid

  /api/forgot-password/reset:
    post:
      summary: Reset Password Baru
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nip: { type: string }
                otp: { type: string }
                new_password: { type: string }
      responses:
        200:
          description: Password berhasil diubah

  # =======================
  # KEHADIRAN (ABSENSI)
  # =======================
  /api/kehadiran/checkin:
    post:
      summary: Absen Masuk
      tags: [Kehadiran]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                latitude:
                  type: number
                  example: -0.9416
                longitude:
                  type: number
                  example: 100.3700
      responses:
        200:
          description: Checkin Berhasil
          content:
            application/json:
              example:
                message: "Check-in berhasil"
                status: "HADIR"
                waktu: "07:55:00"
                jarak: 10.5
        400:
          description: Validasi Gagal (Jarak Jauh / Sudah Absen / Jadwal Kosong)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                DoubelAbsen:
                  value: { "error": "Anda sudah melakukan Check-in hari ini" }
                JadwalKosong:
                   value: { "error": "Jadwal kerja hari ini belum ditentukan. Hubungi Admin." }
        500:
          description: Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/kehadiran/checkout:
    post:
      summary: Absen Pulang
      tags: [Kehadiran]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                latitude:
                  type: number
                longitude:
                  type: number
      responses:
        200:
          description: Checkout Berhasil

  /api/kehadiran/riwayat:
    get:
      summary: Riwayat Absensi Saya
      tags: [Kehadiran]
      parameters:
        - in: query
          name: bulan
          schema:
            type: string
            example: "02"
        - in: query
          name: tahun
          schema:
            type: string
            example: "2026"
      responses:
        200:
          description: List Riwayat

  /api/jadwal/saya:
    get:
      summary: Get Jadwal Saya (Bulanan)
      tags: [Kehadiran]
      parameters:
        - in: query
          name: bulan
          schema:
            type: string
            example: "02"
        - in: query
          name: tahun
          schema:
            type: string
            example: "2026"
      responses:
        200:
          description: List Jadwal
          content:
            application/json:
              example:
                message: "Berhasil mengambil jadwal saya"
                data:
                  - id: 101
                    tanggal: "2026-02-01"
                    nama_shift: "Pagi"
                    jam_masuk_shift: "08:00"
                    jam_pulang_shift: "16:00"
                    status: "HADIR"
                    jam_masuk_real: "07:55:00"
                    jam_pulang_real: "16:05:00"
        400:
           description: Bad request
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/ErrorResponse'
        500:
           description: Server error
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/ErrorResponse'

  /api/kehadiran/status-hari-ini:
    get:
      summary: Cek Status Kehadiran Hari Ini
      tags: [Kehadiran]
      responses:
        200:
          description: Data Status
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: string
                    enum: [BELUM_ABSEN, HADIR, TERLAMBAT, IZIN, CUTI]
                    description: "Jika BELUM_ABSEN -> Tombol Checkin Aktif. Jika lainnya -> Tombol Mati."
                  data:
                    type: object
                  jadwal:
                    type: object
                    nullable: true
                    description: "Info Shift Hari Ini (Realtime dari Admin)"
                    properties:
                      id: { type: integer }
                      shift_id: { type: integer }
                      nama_shift: { type: string }
                      jam_masuk: { type: string }
                      jam_pulang: { type: string }

  /api/kehadiran/rekap:
    get:
      summary: Rekap Absensi Bulanan
      tags: [Kehadiran]
      parameters:
        - in: query
          name: bulan
          schema:
            type: string
            example: "02"
          required: true
        - in: query
          name: tahun
          schema:
            type: string
            example: "2026"
          required: true
      responses:
        200:
          description: Statistik Kehadiran
          content:
            application/json:
              example:
                message: "Rekap berhasil"
                data:
                  hadir: 20
                  terlambat: 2
                  izin: 1
                  cuti: 0
                  detail: []

  # =======================
  # PERIZINAN (CUTI/SAKIT)
  # =======================
  /api/perizinan/cuti:
    post:
      summary: Ajukan Izin atau Cuti
      tags: [Perizinan]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                tipe:
                  type: string
                  enum: [IZIN, CUTI]
                jenis_izin:
                  type: string
                tanggal_mulai:
                  type: string
                  example: "2026-02-01"
                tanggal_selesai:
                  type: string
                  example: "2026-02-03"
                keterangan:
                  type: string
                file_bukti:
                  type: string
                  format: binary
                  description: "File gambar/dokumen bukti (Opsional)"
      responses:
        200:
          description: Berhasil diajukan

  /api/perizinan/riwayat:
    get:
      summary: Riwayat Pengajuan Saya
      tags: [Perizinan]
      responses:
        200:
          description: List Pengajuan

  /api/perizinan/bawahan:
    get:
      summary: (Atasan) Lihat Pengajuan Bawahan
      tags: [Perizinan]
      responses:
        200:
          description: List Pengajuan Bawahan

  /api/perizinan/approval:
    post:
      summary: (Atasan) Approve/Reject Izin
      tags: [Perizinan]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                perizinan_id:
                  type: integer
                status:
                  type: string
                  enum: [DISETUJUI, DITOLAK]
      responses:
        200:
          description: Status diperbarui

  # =======================
  # KOREKSI ABSEN
  # =======================
  /api/koreksi/ajukan:
    post:
      summary: Ajukan Koreksi Absen
      tags: [Koreksi]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                tanggal_kehadiran:
                  type: string
                  example: "2026-02-10"
                tipe_koreksi:
                  type: string
                  enum: [TELAT, PULANG_CEPAT, LUAR_RADIUS]
                alasan:
                  type: string
                file_bukti:
                  type: string
                  format: binary
                  description: "File bukti pendukung (Opsional)"
      responses:
        200:
          description: Berhasil diajukan

  /api/koreksi/riwayat:
    get:
      summary: Riwayat Koreksi Saya
      tags: [Koreksi]
      responses:
        200:
          description: List Koreksi

  /api/koreksi/bawahan:
    get:
      summary: (Atasan) Lihat Koreksi Bawahan
      tags: [Koreksi]
      responses:
        200:
          description: List Koreksi Bawahan

  /api/koreksi/approval:
    post:
      summary: (Atasan) Approve/Reject Koreksi
      tags: [Koreksi]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                koreksi_id:
                  type: integer
                status:
                  type: string
                  enum: [DISETUJUI, DITOLAK]
      responses:
        200:
          description: Status diperbarui

  # =======================
  # BANNER
  # =======================
  /api/banner:
    get:
      summary: Get All Active Banner
      tags: [Banner]
      responses:
        200:
          description: List Banner
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        title:
                          type: string
                        foto:
                          type: string
                          description: Full URL Image (http://.../uploads/...)
                        is_active:
                          type: boolean
